{{# include "./BasePage.html" #}}
{{# namespace "EL" "@goapplib/components/EntityListing.html" #}}

{{/* Drawing-specific grid card placeholder - pencil/sketch icon */}}
{{ define "DrawingGridCardPlaceholder" }}
<svg class="w-16 h-16 text-indigo-200 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"></path>
</svg>
{{ end }}

{{/* Drawing-specific empty state icon */}}
{{ define "DrawingEmptyStateIcon" }}
<svg class="w-12 h-12 text-indigo-500 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"></path>
</svg>
{{ end }}

{{/* Drawing-specific table row icon */}}
{{ define "DrawingTableRowIcon" }}
<svg class="w-6 h-6 text-indigo-500 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"></path>
</svg>
{{ end }}

{{/* Extend Grid and Table with drawing-specific icons */}}
{{# extend "EL:Grid" "DrawingGrid"
           "EL:GridCardPlaceholder" "DrawingGridCardPlaceholder" #}}

{{# extend "EL:Table" "DrawingTable"
           "EL:TableRowIcon" "DrawingTableRowIcon" #}}

{{# extend "EL:EmptyState" "DrawingEmptyState"
           "EL:EmptyStateIcon" "DrawingEmptyStateIcon" #}}

{{# extend "EL:Scripts" "DrawingScripts" #}}

{{ define "BodySection" }}
<div class="min-h-screen flex flex-col">
    <main class="flex-grow w-full">
        {{/*
          Override EntityListing's main template to always render Grid + Table + EmptyState.
          The default EntityListing uses {{ if .Items }} which hides the grid when Items
          is empty. Since our items come from IndexedDB (not the server), Items is always
          empty at render time. Client JS populates the grid and toggles visibility.
        */}}
        <div>
            {{ template "EL:PageHeader" .ListingData }}
            {{ template "EL:Controls" .ListingData }}

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
                {{/* Always render all three â€” JS controls visibility */}}
                <div id="drawings-grid-wrapper">
                    {{ template "DrawingGrid" .ListingData }}
                    {{ template "DrawingTable" .ListingData }}
                </div>
                <div id="drawings-empty-state">
                    {{ template "DrawingEmptyState" .ListingData }}
                </div>
            </div>

            {{ template "DrawingScripts" .ListingData }}
        </div>
    </main>
</div>

<!-- Loading overlay shown while IndexedDB loads -->
<div id="drawings-loading" class="fixed inset-0 bg-gray-50/80 dark:bg-gray-900/80 flex items-center justify-center z-50">
    <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-2 border-indigo-600 border-t-transparent"></div>
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">Loading drawings...</p>
    </div>
</div>

<!-- Tool selection modal for new drawings -->
<div id="tool-modal" class="hidden fixed inset-0 z-50">
    <div class="fixed inset-0 bg-black/50 dark:bg-black/70" id="tool-modal-backdrop"></div>
    <div class="fixed inset-0 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 w-full max-w-md p-6 relative">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">New Drawing</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Choose a tool to get started</p>
            <div id="tool-grid" class="grid grid-cols-2 gap-4">
                <!-- Tools injected by JS -->
            </div>
            <button id="tool-modal-close" class="absolute top-4 right-4 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<script src="/static/playground/listing/bundle.js"></script>
{{ end }}

{{ define "PostBodySection" }}{{ end }}

{{ define "PlaygroundListPage" }}
{{ template "BasePage" . }}
{{ end }}
